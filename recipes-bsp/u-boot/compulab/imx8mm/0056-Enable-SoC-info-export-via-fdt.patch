From 673ca8213a3ba0756dc445adacd2090368ca41ca Mon Sep 17 00:00:00 2001
From: Kirill Kapranov <kirill.kapranov@compulab.co.il>
Date: Sun, 22 Aug 2021 23:23:00 +0300
Subject: [PATCH 56/57] Enable SoC info export via fdt

Signed-off-by: Kirill Kapranov <kirill.kapranov@compulab.co.il>
---
 board/compulab/ucm-imx8m-mini/ucm-imx8m-mini.c | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/board/compulab/ucm-imx8m-mini/ucm-imx8m-mini.c b/board/compulab/ucm-imx8m-mini/ucm-imx8m-mini.c
index ac06bdcfc1..5fcef9bfff 100644
--- a/board/compulab/ucm-imx8m-mini/ucm-imx8m-mini.c
+++ b/board/compulab/ucm-imx8m-mini/ucm-imx8m-mini.c
@@ -214,8 +214,24 @@ phys_size_t get_effective_memsize(void)
 }
 
 #ifdef CONFIG_OF_BOARD_SETUP
+static int fdt_set_soc_info(void *blob)
+{
+	char tmp[128];
+	u32 cpurev = get_cpu_rev();
+
+	int nodeoff = fdt_add_subnode(blob, 0, "soc.info");
+	if(0 > nodeoff)
+		return nodeoff;
+
+	fdt_setprop(blob, nodeoff, "imx.type", tmp, sprintf(tmp, "i.MX%s", get_imx_type((cpurev & 0x1FF000) >> 12)));
+	fdt_setprop(blob, nodeoff, "imx.rev", tmp, sprintf(tmp, "%d.%d", (cpurev & 0x000F0) >>4, cpurev & 0x0000F));
+
+	return 0;
+}
+
 int ft_board_setup(void *blob, bd_t *bd)
 {
+	fdt_set_soc_info(blob);
 	return 0;
 }
 #endif
-- 
2.11.0

