From 497e8f855985a2409be152233b8d9e770f7e0387 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Mon, 25 May 2020 16:03:48 +0300
Subject: [PATCH 42/43] plat: imx8mm: Move common code to platform

1) ddr detection logics and timings
2) eeprom spl/u-boot

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 board/compulab/plat/imx8mm/Makefile                            |  2 ++
 board/compulab/plat/imx8mm/ddr/Makefile                        |  5 +++++
 board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/ddr.c       |  0
 board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/ddr.h       |  0
 .../imx8mm}/ddr/lpddr4_timing_01050008.c                       |  0
 .../imx8mm}/ddr/lpddr4_timing_01061010.c                       |  0
 .../imx8mm}/ddr/lpddr4_timing_ff000110.c                       |  0
 .../imx8mm}/ddr/lpddr4_timing_ff020008.c                       |  0
 board/compulab/plat/imx8mm/eeprom/Makefile                     |  6 ++++++
 board/compulab/{ucm-imx8m-mini => plat/imx8mm/eeprom}/eeprom.c |  0
 board/compulab/{ucm-imx8m-mini => plat/imx8mm/eeprom}/eeprom.h |  0
 .../{ucm-imx8m-mini => plat/imx8mm/eeprom}/eeprom_spl.c        |  0
 board/compulab/ucm-imx8m-mini/Makefile                         | 10 ++--------
 13 files changed, 15 insertions(+), 8 deletions(-)
 create mode 100644 board/compulab/plat/imx8mm/Makefile
 create mode 100644 board/compulab/plat/imx8mm/ddr/Makefile
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/ddr.c (100%)
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/ddr.h (100%)
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/lpddr4_timing_01050008.c (100%)
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/lpddr4_timing_01061010.c (100%)
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/lpddr4_timing_ff000110.c (100%)
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm}/ddr/lpddr4_timing_ff020008.c (100%)
 create mode 100644 board/compulab/plat/imx8mm/eeprom/Makefile
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm/eeprom}/eeprom.c (100%)
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm/eeprom}/eeprom.h (100%)
 rename board/compulab/{ucm-imx8m-mini => plat/imx8mm/eeprom}/eeprom_spl.c (100%)

diff --git a/board/compulab/plat/imx8mm/Makefile b/board/compulab/plat/imx8mm/Makefile
new file mode 100644
index 0000000000..04b9b2e8f8
--- /dev/null
+++ b/board/compulab/plat/imx8mm/Makefile
@@ -0,0 +1,2 @@
+obj-y += ddr/
+obj-y += eeprom/
diff --git a/board/compulab/plat/imx8mm/ddr/Makefile b/board/compulab/plat/imx8mm/ddr/Makefile
new file mode 100644
index 0000000000..bf8a968277
--- /dev/null
+++ b/board/compulab/plat/imx8mm/ddr/Makefile
@@ -0,0 +1,5 @@
+obj-y += ddr.o
+obj-y += lpddr4_timing_ff020008.o
+obj-y += lpddr4_timing_ff000110.o
+obj-y += lpddr4_timing_01061010.o
+obj-y += lpddr4_timing_01050008.o
diff --git a/board/compulab/ucm-imx8m-mini/ddr/ddr.c b/board/compulab/plat/imx8mm/ddr/ddr.c
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/ddr/ddr.c
rename to board/compulab/plat/imx8mm/ddr/ddr.c
diff --git a/board/compulab/ucm-imx8m-mini/ddr/ddr.h b/board/compulab/plat/imx8mm/ddr/ddr.h
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/ddr/ddr.h
rename to board/compulab/plat/imx8mm/ddr/ddr.h
diff --git a/board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_01050008.c b/board/compulab/plat/imx8mm/ddr/lpddr4_timing_01050008.c
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_01050008.c
rename to board/compulab/plat/imx8mm/ddr/lpddr4_timing_01050008.c
diff --git a/board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_01061010.c b/board/compulab/plat/imx8mm/ddr/lpddr4_timing_01061010.c
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_01061010.c
rename to board/compulab/plat/imx8mm/ddr/lpddr4_timing_01061010.c
diff --git a/board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_ff000110.c b/board/compulab/plat/imx8mm/ddr/lpddr4_timing_ff000110.c
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_ff000110.c
rename to board/compulab/plat/imx8mm/ddr/lpddr4_timing_ff000110.c
diff --git a/board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_ff020008.c b/board/compulab/plat/imx8mm/ddr/lpddr4_timing_ff020008.c
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/ddr/lpddr4_timing_ff020008.c
rename to board/compulab/plat/imx8mm/ddr/lpddr4_timing_ff020008.c
diff --git a/board/compulab/plat/imx8mm/eeprom/Makefile b/board/compulab/plat/imx8mm/eeprom/Makefile
new file mode 100644
index 0000000000..6e61b4a414
--- /dev/null
+++ b/board/compulab/plat/imx8mm/eeprom/Makefile
@@ -0,0 +1,6 @@
+ifdef CONFIG_SPL_BUILD
+obj-y += eeprom_spl.o
+else
+obj-y += eeprom.o
+endif
+
diff --git a/board/compulab/ucm-imx8m-mini/eeprom.c b/board/compulab/plat/imx8mm/eeprom/eeprom.c
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/eeprom.c
rename to board/compulab/plat/imx8mm/eeprom/eeprom.c
diff --git a/board/compulab/ucm-imx8m-mini/eeprom.h b/board/compulab/plat/imx8mm/eeprom/eeprom.h
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/eeprom.h
rename to board/compulab/plat/imx8mm/eeprom/eeprom.h
diff --git a/board/compulab/ucm-imx8m-mini/eeprom_spl.c b/board/compulab/plat/imx8mm/eeprom/eeprom_spl.c
similarity index 100%
rename from board/compulab/ucm-imx8m-mini/eeprom_spl.c
rename to board/compulab/plat/imx8mm/eeprom/eeprom_spl.c
diff --git a/board/compulab/ucm-imx8m-mini/Makefile b/board/compulab/ucm-imx8m-mini/Makefile
index 1db67f186a..f30d5e645a 100644
--- a/board/compulab/ucm-imx8m-mini/Makefile
+++ b/board/compulab/ucm-imx8m-mini/Makefile
@@ -7,14 +7,8 @@
 obj-y += ucm-imx8m-mini.o
 
 ifdef CONFIG_SPL_BUILD
+ccflags-y += -I$(srctree)/board/compulab/plat/imx8mm/
 obj-y += spl.o
-obj-y += ddr/ddr.o
-obj-y += ddr/lpddr4_timing_ff020008.o
-obj-y += ddr/lpddr4_timing_ff000110.o
-obj-y += ddr/lpddr4_timing_01061010.o
-obj-y += ddr/lpddr4_timing_01050008.o
-obj-y += eeprom_spl.o
-else
-obj-y += ucm-imx8m-mini.o eeprom.o
 endif
 
+obj-y += ../plat/imx8mm/
-- 
2.11.0

