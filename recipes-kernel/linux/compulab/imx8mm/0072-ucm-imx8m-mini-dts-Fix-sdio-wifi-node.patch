From 50bb8a27850b2f6ff3af6bd14bd0dd457726cb48 Mon Sep 17 00:00:00 2001
From: Kirill Kapranov <kirill.kapranov@compulab.co.il>
Date: Wed, 3 Feb 2021 20:04:25 +0200
Subject: [PATCH 72/72] ucm-imx8m-mini:dts:Fix sdio wifi node

Signed-off-by: Kirill Kapranov <kirill.kapranov@compulab.co.il>
---
 .../boot/dts/compulab/ucm-imx8m-mini.dtsi     | 20 ++++++-------------
 1 file changed, 6 insertions(+), 14 deletions(-)

diff --git a/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dtsi b/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dtsi
index 79cfcccfb79c..145340cce91a 100644
--- a/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dtsi
+++ b/arch/arm64/boot/dts/compulab/ucm-imx8m-mini.dtsi
@@ -49,19 +49,6 @@
 		};
 	};
 
-	//Fake regulator provides WL_REG_ON signal for wireless interface
-	wlreg_on: wlregon-regulator {
-		compatible = "regulator-fixed";
-		regulator-min-microvolt = <3300000>;
-		regulator-max-microvolt = <3300000>;
-		regulator-name = "wlreg_on";
-		gpio = <&gpio2 10 GPIO_ACTIVE_HIGH>;
-		startup-delay-us = <100>;
-		enable-active-high;
-		regulator-always-on;
-		status = "okay";
-	};
-
 	reg_usdhc2_vmmc: regulator-usdhc2 {
 		compatible = "regulator-fixed";
 		regulator-name = "VSD_3V3";
@@ -662,11 +649,16 @@
 	non-removable;
 	wifi-host;
 	pm-ignore-notify;
-	vmmc-supply = <&wlreg_on>;
+	cap-power-off-card;
 	status = "okay";
+	mmc-pwrseq = <&usdhc1_pwrseq>;
+
 	brcmf: wifi@1 {
 		compatible = "brcm,bcm4329-fmac";
 		reg = <1>;
+		interrupt-parent = <&gpio2>;
+		interrupts = <9 IRQ_TYPE_LEVEL_HIGH>;
+		interrupt-names = "host-wake";
 	};
 };
 
-- 
2.17.1

