From c0ad08456453b07ad6297ec5f0400e853da13863 Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Thu, 3 Jun 2021 13:15:31 +0300
Subject: [PATCH] mcm-imx8m-mini: Add input sample dts

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm64/boot/dts/compulab/Makefile              |  3 +-
 .../boot/dts/compulab/mcm-imx8m-mini-input.dtsi    | 37 ++++++++++++++++++++++
 .../boot/dts/compulab/sbc-mcm-imx8m-mini-input.dts | 10 ++++++
 3 files changed, 49 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm64/boot/dts/compulab/mcm-imx8m-mini-input.dtsi
 create mode 100644 arch/arm64/boot/dts/compulab/sbc-mcm-imx8m-mini-input.dts

diff --git a/arch/arm64/boot/dts/compulab/Makefile b/arch/arm64/boot/dts/compulab/Makefile
index e640d7bc0285..8a64681cd8c7 100644
--- a/arch/arm64/boot/dts/compulab/Makefile
+++ b/arch/arm64/boot/dts/compulab/Makefile
@@ -8,7 +8,8 @@ dtb-$(CONFIG_ARCH_MXC) += mcm-imx8m-mini-thermal.dtb
 dtb-$(CONFIG_ARCH_MXC) += sbc-mcm-imx8m-mini.dtb
 dtb-$(CONFIG_ARCH_MXC) += sbc-mcm-imx8m-mini-rs485.dtb
 dtb-$(CONFIG_ARCH_MXC) += sbc-mcm-imx8m-mini-spidev.dtb
+dtb-$(CONFIG_ARCH_MXC) += sbc-mcm-imx8m-mini-input.dtb
 
-always         := $(dtb-y)
+always-y       := $(dtb-y)
 subdir-y       := $(dts-dirs)
 clean-files    := *.dtb
diff --git a/arch/arm64/boot/dts/compulab/mcm-imx8m-mini-input.dtsi b/arch/arm64/boot/dts/compulab/mcm-imx8m-mini-input.dtsi
new file mode 100644
index 000000000000..19c3e8b11df0
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/mcm-imx8m-mini-input.dtsi
@@ -0,0 +1,37 @@
+/* SB-MCM8M P20 header
+* P20.28  -- GPIO1_IO8
+*/
+
+#include <dt-bindings/input/linux-event-codes.h>
+
+/ {
+	gpio_keys: gpio-keys {
+		compatible = "gpio-keys";
+		autorepeat;
+
+		back {
+			gpios = <&gpio1 8 GPIO_ACTIVE_LOW>;
+			linux,code = <KEY_PROG1>;
+			label = "Key Prog1";
+			linux,input-type = <1>;
+			debounce-interval = <100>;
+			wakeup-source;
+		};
+	};
+};
+
+&iomuxc {
+	mcm-imx8m-mini-input {
+		pinctrl_input: input1grp {
+			fsl,pins = <
+				MX8MM_IOMUXC_GPIO1_IO08_GPIO1_IO8	0x159
+			>;
+		};
+	};
+};
+
+&gpio_keys {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_input>;
+};
+
diff --git a/arch/arm64/boot/dts/compulab/sbc-mcm-imx8m-mini-input.dts b/arch/arm64/boot/dts/compulab/sbc-mcm-imx8m-mini-input.dts
new file mode 100644
index 000000000000..30165184816d
--- /dev/null
+++ b/arch/arm64/boot/dts/compulab/sbc-mcm-imx8m-mini-input.dts
@@ -0,0 +1,10 @@
+/dts-v1/;
+
+#include "mcm-imx8m-mini.dts"
+#include "mcm-imx8m-mini-input.dtsi"
+#include "sb-mcm-imx8-rev1.dtsi"
+
+/ {
+	model = "CompuLab MCM i.MX8MM on SB-MCM8M Rev 1.0";
+	compatible = "cpl,sbc-mcm-imx8m-mini", "cpl,mcm-imx8m-mini", "fsl,imx8mm";
+};
-- 
2.11.0

